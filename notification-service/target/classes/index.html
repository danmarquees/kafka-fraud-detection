<!doctype html>
<html>
    <head>
        <title>Dashboard de Detec√ß√£o de Fraudes</title>
        <link
            rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
        />
        <style>
            body {
                padding: 20px;
                font-family: sans-serif;
                background-color: #f8f9fa;
            }
            h1 {
                color: #b22222;
            }
            .card {
                border-left: 5px solid #b22222;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <h1 class="mb-4">üî¥ Alertas de Fraude em Tempo Real</h1>
            <div id="alerts-container"></div>
        </div>

        <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1.5.1/dist/sockjs.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
        <script>
            // Conecta ao endpoint WebSocket exposto pelo backend
            const socket = new SockJS("/ws-alerts");
            const stompClient = Stomp.over(socket);

            stompClient.connect({}, function (frame) {
                console.log("Conectado: " + frame);
                // Se inscreve no t√≥pico /topic/frauds para receber os alertas
                stompClient.subscribe("/topic/frauds", function (alert) {
                    const fraud = JSON.parse(alert.body);
                    console.log("Novo alerta de fraude recebido:", fraud);
                    showAlert(fraud);
                });
            });

            function showAlert(fraud) {
                const container = document.getElementById("alerts-container");
                const alertDiv = document.createElement("div");
                alertDiv.className = "card mb-3";
                alertDiv.innerHTML = `
                <div class="card-body">
                    <h5 class="card-title">Fraude Detectada!</h5>
                    <p class="card-text mb-1"><strong>Usu√°rio:</strong> ${fraud.userId}</p>
                    <p class="card-text mb-1"><strong>Valor:</strong> R$ ${fraud.amount.toFixed(2)}</p>
                    <p class="card-text mb-0"><small class="text-muted">ID da Transa√ß√£o: ${fraud.transactionId}</small></p>
                </div>
            `;
                // Insere o novo alerta no topo da lista
                container.prepend(alertDiv);
            }
        </script>
    </body>
</html>
